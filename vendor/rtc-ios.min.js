!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),(t.RTC||(t.RTC={})).IOS=e()}}(function(){return function e(t,n,r){function i(c,a){if(!n[c]){if(!t[c]){var s="function"==typeof require&&require;if(!a&&s)return s(c,!0);if(o)return o(c,!0);var u=new Error("Cannot find module '"+c+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[c]={exports:{}};t[c][0].call(f.exports,function(e){var n=t[c][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[c].exports}for(var o="function"==typeof require&&require,c=0;c<r.length;c++)i(r[c]);return i}({1:[function(e,t,n){"use strict";var r=e("objectfit"),i=e("rtc-proxy/mediastream"),o=e("rtc-proxy/peerconnection"),c=/\(iOS\;.*Mobile\/NICTA/,a=!1,s=!1;n.supported=function(){return"undefined"!=typeof navigator&&c.test(navigator.userAgent)};n.init=function(e,t){function n(){var e;return s?t():(document.removeEventListener("deviceready",n),e=window.console.log,window.console.log=function(){var t=[].slice.call(arguments).join(" ");try{NativeLog(t)}catch(e){alert(t)}e.apply(window.console,arguments)},"function"==typeof getUserMedia&&(navigator.getUserMedia=function(e,t,n){getUserMedia(e,function(e){t(new i(e))},n)}),s=!0,console.log("iOS plugin initialized, getUserMedia available = "+!!navigator.getUserMedia),void t())}return a?setTimeout(n,10):void document.addEventListener("deviceready",n)};n.attach=function(e,t){function n(){var e=a.getBoundingClientRect(),t=window.getComputedStyle(a),n=r[t.objectFit]||r.contain;a.width=e.width,a.height=e.height,o=n([0,0,e.width,e.height]),i()}function i(){c&&s.drawImage.apply(s,[c].concat(o([0,0,c.width,c.height])))}var o,c,a=u(t,(t||{}).el),s=a.getContext("2d");return e&&e.__orig&&(e=e.__orig),window.addEventListener("resize",n,!1),window.addEventListener("load",n,!1),iOSRTC_onDrawRegi(e,function(e){c=new Image,c.onload=i,c.src=e}),setTimeout(n,10),a},n.attachStream=function(e,t){var n=[],r=0,i=0;n=t.map(function(e){return e.el.getContext("2d")}),e&&e.__orig&&(e=e.__orig),iOSRTC_onDrawRegi(e,function(e,t,o){var c=!1;try{var a=new Image;c=t!==r||o!==i,a.onload=function(){n.forEach(function(e){c&&(e.canvas.width=t,e.canvas.height=o),e.drawImage(a,0,0,t,o)})},a.src=e}catch(e){console.log("encountered error while drawing video"),console.log("error: "+e.message)}r=t,i=o})};var u=n.prepareElement=function(e,t){var n,r,i=t instanceof HTMLVideoElement||t instanceof HTMLAudioElement,o=document.createElement("canvas"),c=i?t.parentNode:t;return console.log("preparing element, created canvas"),i?(console.log("getting computed style for the element"),n=window.getComputedStyle(t),console.log("getting client bounding rect"),r=t.getBoundingClientRect(),console.log("setting w and h"),o.width=r.width,o.height=r.height,o.className=t.className,console.log("inserting canvas"),c.insertBefore(o,t),c.removeChild(t)):c&&c.appendChild(o),o};n.createIceCandidate=function(e){return console.log("creating ice candidate, keys: "+Object.keys(e).join(" ")),getRTCIceCandidate({sdpMLineIndex:(e||{}).sdpMLineIndex,candidate:(e||{}).candidate})},n.createConnection=function(e,t){return e.iceServers=(e.iceServers||[]).map(function(e){var t=(e||{}).url;return console.log("specifying ice url: "+t),{url:t}}),new o(getPeerConnection(e,t))},n.createSessionDescription=function(e){return getRTCSessionDescription(e)},"undefined"!=typeof document&&document.addEventListener("deviceready",function(){a=!0})},{objectfit:4,"rtc-proxy/mediastream":6,"rtc-proxy/peerconnection":9}],2:[function(e,t){t.exports=function(e,t){function n(t){var n=t[2],c=t[3],a=n/c,s=[];return o>a?(s[2]=i*a|0,s[3]=i,s[0]=r-s[2]>>1,s[1]=0):(s[2]=r,s[3]=r/a|0,s[0]=0,s[1]=i-s[3]>>1),s[0]+=e[0],s[1]+=e[1],s}var r=e[2],i=e[3],o=r/i;return t?n(t):n}},{}],3:[function(e,t){t.exports=function(e,t){function n(t){var n=t[2],c=t[3],a=n/c,s=[];return o>a?(s[2]=r,s[3]=r/a|0,s[0]=1,s[1]=-(s[3]-i)>>1):(s[2]=i*a|0,s[3]=i,s[0]=-(s[2]-r)>>1,s[1]=0),s[0]+=e[0],s[1]+=e[1],s}var r=e[2],i=e[3],o=r/i;return t?n(t):n}},{}],4:[function(e,t,n){n.contain=e("./contain"),n.cover=e("./cover")},{"./contain":2,"./cover":3}],5:[function(e,t){var n=e("eventemitter3"),r=e("cog/extend");t.exports=function(e,t,i,o){function c(e,t){var n=a(e);return"function"!=typeof e.__orig["on"+t]&&(e.__orig["on"+t]=function(){n.emit.apply(n,[t].concat([].slice.call(arguments)))}),n}function a(e){return e.__emitter||(e.__emitter=new n),e.__emitter}return(t||[]).forEach(function(t){e[t]=function(){var e=this.__orig&&this.__orig[t];return"function"==typeof e?e.apply(this.__orig,arguments):void console.warn("could not invoke: "+t)}}),(i||[]).forEach(function(t){var n=t[0],i=r({get:function(){return this.__orig&&this.__orig[n]}},t[1]);i.writable&&!i.set&&(i.set=function(e){this.__orig&&(this.__orig[n]=e)}),Object.defineProperty(e,n,i)}),(o||[]).forEach(function(t){Object.defineProperty(e,"on"+t,{get:function(){return a(this).listeners(t)[0]},set:function(e){var n=c(this,t);return e?void n.on(t,e):n.removeAllListeners(t)}})}),o&&(e.addEventListener=function(e,t){c(this,e).on(e,t)},e.removeEventListener=function(e,t){a(this).removeListener(e,t)}),e}},{"cog/extend":7,eventemitter3:8}],6:[function(e,t){function n(e){return this instanceof n?(this.__orig=e,void r(this,[],[["id",{enumerable:!0}],["ended",{enumerable:!0}]])):new n(e)}var r=e("./index");t.exports=n;var i=r(n.prototype,["getAudioTracks","getVideoTracks","getTrackById","addTrack","removeTrack"],[],["ended","addtrack","removetrack"]);i.clone=function(){return new n(this.__orig)}},{"./index":5}],7:[function(e,t){"use strict";t.exports=function(e){return[].slice.call(arguments,1).forEach(function(t){if(t)for(var n in t)e[n]=t[n]}),e}},{}],8:[function(e,t){"use strict";function n(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(){}r.prototype._events=void 0,r.prototype.listeners=function(e){if(!this._events||!this._events[e])return[];for(var t=0,n=this._events[e].length,r=[];n>t;t++)r.push(this._events[e][t].fn);return r},r.prototype.emit=function(e,t,n,r,i,o){if(!this._events||!this._events[e])return!1;var c,a,s,u=this._events[e],f=u.length,d=arguments.length,l=u[0];if(1===f){switch(l.once&&this.removeListener(e,l.fn,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,r),!0;case 5:return l.fn.call(l.context,t,n,r,i),!0;case 6:return l.fn.call(l.context,t,n,r,i,o),!0}for(a=1,c=new Array(d-1);d>a;a++)c[a-1]=arguments[a];l.fn.apply(l.context,c)}else for(a=0;f>a;a++)switch(u[a].once&&this.removeListener(e,u[a].fn,!0),d){case 1:u[a].fn.call(u[a].context);break;case 2:u[a].fn.call(u[a].context,t);break;case 3:u[a].fn.call(u[a].context,t,n);break;default:if(!c)for(s=1,c=new Array(d-1);d>s;s++)c[s-1]=arguments[s];u[a].fn.apply(u[a].context,c)}return!0},r.prototype.on=function(e,t,r){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),this._events[e].push(new n(t,r||this)),this},r.prototype.once=function(e,t,r){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),this._events[e].push(new n(t,r||this,!0)),this},r.prototype.removeListener=function(e,t,n){if(!this._events||!this._events[e])return this;var r=this._events[e],i=[];if(t)for(var o=0,c=r.length;c>o;o++)r[o].fn!==t&&r[o].once!==n&&i.push(r[o]);return this._events[e]=i.length?i:null,this},r.prototype.removeAllListeners=function(e){return this._events?(e?this._events[e]=null:this._events={},this):this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.EventEmitter=r,r.EventEmitter2=r,r.EventEmitter3=r,"object"==typeof t&&t.exports&&(t.exports=r)},{}],9:[function(e,t){function n(e){return this instanceof n?(this.__orig=e,void r(this,[],[["localDescription",{enumerable:!0}],["remoteDescription",{enumerable:!0}],["signalingState",{enumerable:!0}],["iceGatheringState",{enumerable:!0}],["iceConnectionState",{enumerable:!0}]])):new n(e)}var r=e("./index"),i=e("./mediastream");t.exports=n;var o=r(n.prototype,["createOffer","createAnswer","createDataChannel","setLocalDescription","setRemoteDescription","updateIce","addIceCandidate","close"],[],["negotiationneeded","icecandidate","signalingstatechange","addstream","removestream","iceconnectionstatechange","datachannel"]);o.addStream=function(e){return e?this.__orig.addStream(e.__orig||e):void 0},o.removeStream=function(e){return e?this.__orig.removeStream(e.__orig||e):void 0},o.getLocalStreams=function(){return this.__orig.getLocalStreams().map(i)},o.getRemoteStreams=function(){return this.__orig.getRemoteStreams().map(i)},o.getStreamById=function(e){var t=this.__orig.getStreamById(e);return t&&(t=new i(t)),t}},{"./index":5,"./mediastream":6}]},{},[1])(1)});
//# sourceMappingURL=rtc.min.js.map